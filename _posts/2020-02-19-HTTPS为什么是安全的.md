---
layout: post
title:  "HTTPS为什么是安全的"
date:   2020-02-19 11:00:54 -0000
categories: Tech
tags: Internet
---

如果不了解[Https](https://en.wikipedia.org/wiki/HTTPS)是什么, 可以先点击去wiki了解一下，这里不在赘述。

首先我们定义一下什么是安全，通俗的说就是真实的request 和 response 内容（有业务意义的），即使被黑客截取，也是无法读取的。你的消息可能会丢失，但是除了和你通信的人，不会被其他人读到。

下面我们通过流程来看一下为什么https是安全的。  

![流程图]({{ "img/https.jpg" | absolute_url }})

---

##### 1. client端发送https建立连接的请求。

##### 2. server端收到请求，返回包含公匙的证书，通过此公匙加密之后的内容，只能通过私匙解密，server端拥有唯一私匙。

证书：证书本质上是借用第三方来确定身份的可靠性。机构发布证书，浏览器信任证书。或者个人发布证书，个人添加信任，这样的话个人既能控制client，又能控制server， 那就没有黑请求的必要了。  

公匙私匙：非对称加密的概念，即加密和解密不是用同一个密匙，公钥负责加密，私钥负责解密，即使加密内容被截获，没有私钥也不能破解，算法速度较慢。可以理解为寄了一个打开的保险箱到client，把东西（对称加密的密匙）放进去，合上保险箱寄回server，只有server有钥匙才能打开。

##### 3. client端收到证书，TLS验证证书的合法性。 

这里的关键是保证黑客的证书不能取得client的信任。

##### 4. 产生一个随机数作为对称加密的random-key， 用收到的公匙将random-key加密，发送给server。 

随机数可以保证一次连接一个对称密匙，截取本地保存的密匙，下次请求时也是没用的。

##### 5. server 用私匙解密random-key, 获得了用于解密request内容，和加密response内容的对称密匙。  

此密匙因为前面的步骤，保证了只有此次连接的server和client端持有。对称加密算法更快。
##### 6. 传输和解码 加密的内容。
---

`一些我曾经的困惑:`

##### 1. 为什么不直接用私匙共匙加密传输呢？

client端的数据，用public-key加密后，只能在拥有private-key的服务器端可以解密，那为什么不一直用这种方式呢？抛开性能的影响，我们还是忽略了一个问题，server端怎么向client发送数据呢？client端是没有private-key的，所以服务端不能用public-key加密。那server端能不能不加密呢，比如每次发送消息带上证书？
还是不行的，证书保证的是发消息的一方是可信的，但是任何人都能读取里面的信息。

##### 2. 如果双方都是server，各自拥有独立的public/private-key， 那能否安全传输呢？

按照文章最开始的安全定义，那么这是能够保证的，因为解密由private-key的唯一性保证。那还存在什么问题呢？这时候就需要看一下这个方案和HTTPS的方案有什么差别，HTTPS的方案里，加密用的是一个只有client和server知晓的random-key，而在这个方案中用的是public-key，public也意味着所有人都可以知道，也就是所有人都能加密内容，也就是黑客去模拟真实请求的时候，会变得很容易。而HTTPS因为不知道random-key的存在，是没办法模拟真实请求的。在这种情况下，黑客虽然听不懂client和server的对话，但是可以说client和server能听懂的话。这里应该是存在风险的。





